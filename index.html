<!doctype html>
<html lang="zh-TW" data-app="sleep-secretary" data-version="19.1.1">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <title>作息秘書 v19.1.1</title>
  <meta name="description" content="作息秘書｜作息提醒＋關係滋養：微休息、護眼、番茄、知識區、關係滋養、生日提醒（可加入主畫面使用）" />
  <meta name="theme-color" content="#0b241d" />
  <meta name="background-color" content="#0b241d" />

  <!-- PWA -->
  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="icon" type="image/png" sizes="192x192" href="./icon-192.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="./icon-512.png" />
  <link rel="apple-touch-icon" href="./icon-192.png" />

  <!-- ✅ CSS（外連） -->
  <link rel="stylesheet" href="./style.css?v=1911" />

  <!-- ✅ 版本策略（重要）
       以後升級只要改這兩個常數即可：APP_VERSION / ASSET_TAG
       - APP_VERSION：顯示版本（例如 19.1.2）
       - ASSET_TAG：快取破壞用（例如 1912）
  -->
  <script>
    window.APP_VERSION = "19.1.1";
    window.ASSET_TAG = "1911";
  </script>
</head>

<body>
  <!-- =========================
  作息秘書 v19.1.1（HTML）
  ✅ 匹配 v19.1.1 JS（app.js）所需元素 id
  ✅ KB 類別：經絡→筋絡 + 運動 + 其他 + 備忘（HTML 直接補齊）
  ✅ 讓未來升級可自動連到新版 JS：使用 ?v=ASSET_TAG
  ✅ PWA 註冊 + 離線快取：內建註冊 service worker（sw.js）
     （若你 repo 已經有 sw.js，它就會生效；若沒有，下面也有提示）
  ========================= -->

  <div id="app" class="app">
    <!-- Top -->
    <header class="topbar">
      <div class="brand">
        <div class="brandTitle">作息秘書</div>
        <div class="brandSub"><span>作息提醒＋關係滋養</span></div>
      </div>
      <button id="btnInstallHelp" class="btnGhost" type="button">安裝教學</button>
    </header>

    <!-- Tabs -->
    <nav class="tabs" aria-label="主選單">
      <button class="tab active" data-view="home" type="button">首頁</button>
      <button class="tab" data-view="micro" type="button">微休息</button>
      <button class="tab" data-view="eye" type="button">護眼</button>
      <button class="tab" data-view="pomo" type="button">蕃茄</button>
    </nav>

    <!-- Main -->
    <main class="main">
      <!-- HOME -->
      <section class="view active" id="view-home">
        <!-- Quick Cards -->
        <div class="panel">
          <div class="panelHead">
            <div class="panelTitle"><span class="dotLed"></span>選一個模式</div>
            <div class="panelHint">點卡片或上方按鈕都可切換。</div>
          </div>

          <div class="cards">
            <button class="card" data-jump="micro" type="button">
              <div class="cardTop">
                <div class="emoji">⏱️</div>
                <div class="cardName">微休息</div>
              </div>
              <div class="cardDesc">60 秒｜眼睛 or 回身</div>
              <div class="cardTag">點我開始</div>
            </button>

            <button class="card" data-jump="eye" type="button">
              <div class="cardTop">
                <div class="emoji">👁️</div>
                <div class="cardName">護眼</div>
              </div>
              <div class="cardDesc">20-20-20｜放鬆對焦</div>
              <div class="cardTag">點我開始</div>
            </button>

            <button class="card" data-jump="pomo" type="button">
              <div class="cardTop">
                <div class="emoji">🍅</div>
                <div class="cardName">蕃茄模式</div>
              </div>
              <div class="cardDesc">專注＋休息｜節奏管理</div>
              <div class="cardTag">點我開始</div>
            </button>
          </div>

          <div class="note">
            <div class="noteTitle">小提醒</div>
            <div class="noteText">第一次按「開始」可能會觸發瀏覽器允許語音（倒數結束才會播報）。</div>
          </div>
        </div>

        <!-- Knowledge -->
        <div class="panel">
          <div class="panelHead">
            <div class="panelTitle">📚 知識區（平日收集）</div>
            <div class="panelHint">可新增、刪除、篩選、匯出、清空、永久保存</div>
          </div>

          <form id="kbForm" class="kbForm" autocomplete="off">
            <label class="kbField">
              <span class="kbLabel">分類</span>
              <select id="kbCat" class="kbInput">
                <option value="護眼">護眼</option>
                <option value="筋絡">筋絡</option>
                <option value="運動">運動</option>
                <option value="學習效率">學習效率</option>
                <option value="其他">其他</option>
                <option value="備忘">備忘</option>
              </select>
            </label>

            <label class="kbField kbFieldGrow">
              <span class="kbLabel">標題</span>
              <input id="kbTitle" class="kbInput" type="text" maxlength="50" placeholder="例如：20-20-20 的重點" />
            </label>

            <label class="kbField kbFieldGrow">
              <span class="kbLabel">內容</span>
              <input id="kbText" class="kbInput" type="text" maxlength="160" placeholder="例如：每 20 分鐘看遠 20 呎 20 秒（可貼 https:// 連結）" />
            </label>

            <button class="btnPrimary" type="submit">新增</button>
          </form>

          <div class="kbToolbar">
            <div class="kbFilter">
              <span class="kbFilterLabel">篩選：</span>
              <button class="chip active" data-filter="全部" type="button">全部</button>
              <button class="chip" data-filter="護眼" type="button">護眼</button>
              <button class="chip" data-filter="筋絡" type="button">筋絡</button>
              <button class="chip" data-filter="運動" type="button">運動</button>
              <button class="chip" data-filter="學習效率" type="button">學習效率</button>
              <button class="chip" data-filter="其他" type="button">其他</button>
              <button class="chip" data-filter="備忘" type="button">備忘</button>
              <button class="chip" data-filter="筆記" type="button">筆記</button>
            </div>

            <div class="kbActions">
              <button id="kbExport" class="btnGhost" type="button">匯出</button>
              <button id="kbClear" class="btnGhost danger" type="button">清空全部</button>
            </div>
          </div>

          <div id="kbEmpty" class="kbEmpty">尚無資料</div>
          <div id="kbList" class="kbList" aria-live="polite"></div>
        </div>

        <!-- Relationship Nourish -->
        <div class="panel">
          <div class="panelHead">
            <div class="panelTitle">🌿 關係滋養區</div>
            <div class="panelHint">親子／伴侶／人際／自己：每日一句提醒、一次練習、一次靠近</div>
          </div>

          <form id="relForm" class="relForm" autocomplete="off">
            <label class="kbField">
              <span class="kbLabel">面向</span>
              <select id="relCat" class="kbInput">
                <option value="親子">親子</option>
                <option value="伴侶">伴侶</option>
                <option value="人際">人際</option>
                <option value="自己">自己</option>
              </select>
            </label>

            <label class="kbField kbFieldGrow">
              <span class="kbLabel">一句話 / 目標</span>
              <input id="relTitle" class="kbInput" type="text" maxlength="50" placeholder="例如：先聽完再說、先抱一下" />
            </label>

            <label class="kbField kbFieldGrow">
              <span class="kbLabel">練習 / 行動</span>
              <input id="relText" class="kbInput" type="text" maxlength="180" placeholder="例如：今天 3 次『看著眼睛說謝謝』" />
            </label>

            <label class="kbField">
              <span class="kbLabel">頻率</span>
              <select id="relFreq" class="kbInput">
                <option value="今天">今天</option>
                <option value="每天">每天</option>
                <option value="每週">每週</option>
              </select>
            </label>

            <button class="btnPrimary" type="submit">新增</button>
          </form>

          <div class="kbToolbar">
            <div class="kbFilter">
              <span class="kbFilterLabel">篩選：</span>
              <button class="chip2 active" data-relfilter="全部" type="button">全部</button>
              <button class="chip2" data-relfilter="親子" type="button">親子</button>
              <button class="chip2" data-relfilter="伴侶" type="button">伴侶</button>
              <button class="chip2" data-relfilter="人際" type="button">人際</button>
              <button class="chip2" data-relfilter="自己" type="button">自己</button>
            </div>

            <div class="kbActions">
              <button id="relExport" class="btnGhost" type="button">匯出</button>
              <button id="relClear" class="btnGhost danger" type="button">清空全部</button>
            </div>
          </div>

          <div id="relEmpty" class="kbEmpty">尚無資料</div>
          <div id="relList" class="kbList" aria-live="polite"></div>
        </div>

        <!-- Birthday Reminder -->
        <div class="panel">
          <div class="panelHead">
            <div class="panelTitle">🎂 生日提醒</div>
            <div class="panelHint">到點會跳出提醒＋語音播報（在 app 開著時生效）</div>
          </div>

          <div id="bdayToday" class="kbEmpty" style="display:none;"></div>

          <form id="bdayForm" class="bdayForm" autocomplete="off">
            <label class="kbField kbFieldGrow">
              <span class="kbLabel">對象</span>
              <input id="bdayName" class="kbInput" type="text" maxlength="24" placeholder="例如：媽媽 / 朋友" />
            </label>

            <label class="kbField">
              <span class="kbLabel">日期</span>
              <input id="bdayDate" class="kbInput" type="date" />
            </label>

            <label class="kbField">
              <span class="kbLabel">提醒時間</span>
              <input id="bdayTime" class="kbInput" type="time" value="09:00" />
            </label>

            <label class="kbField kbFieldGrow">
              <span class="kbLabel">提醒一句話</span>
              <input id="bdayMsg" class="kbInput" type="text" maxlength="60" placeholder="例如：記得傳祝福、打電話、準備小卡" />
            </label>

            <button class="btnPrimary" type="submit">新增</button>
          </form>

          <div class="kbToolbar">
            <div class="kbActions">
              <button id="bdayExport" class="btnGhost" type="button">匯出</button>
              <button id="bdayClear" class="btnGhost danger" type="button">清空全部</button>
            </div>
          </div>

          <div id="bdayEmpty" class="kbEmpty">尚無資料</div>
          <div id="bdayList" class="kbList" aria-live="polite"></div>
        </div>
      </section>

      <!-- MICRO -->
      <section class="view" id="view-micro">
        <div class="panel">
          <div class="panelHead">
            <div class="panelTitle">⏱️ 微休息｜60 秒</div>
            <div class="panelHint">眼睛放鬆、肩頸轉動、起身走兩步。</div>
          </div>

          <div class="timerBox">
            <div class="timerBig" id="microTime">01:00</div>
            <div class="timerSub" id="microHint">準備好了就開始</div>
            <div class="btnRow">
              <button id="microStart" class="btnPrimary" type="button">開始</button>
              <button id="microPause" class="btnGhost" type="button">暫停</button>
              <button id="microReset" class="btnGhost" type="button">重設</button>
              <button id="microSys" class="btnGhost" type="button">用系統計時器</button>
            </div>
          </div>
        </div>
      </section>

      <!-- EYE -->
      <section class="view" id="view-eye">
        <div class="panel">
          <div class="panelHead">
            <div class="panelTitle">👁️ 護眼｜20-20-20</div>
            <div class="panelHint">20 分鐘專注 → 看遠 20 呎 → 20 秒。</div>
          </div>

          <div class="timerBox">
            <div class="timerBig" id="eyeTime">20:00</div>
            <div class="timerSub" id="eyePhase">20 分鐘專注中</div>
            <div class="btnRow">
              <button id="eyeStart" class="btnPrimary" type="button">開始</button>
              <button id="eyePause" class="btnGhost" type="button">暫停</button>
              <button id="eyeReset" class="btnGhost" type="button">重設</button>
              <button id="eyeSysFocus" class="btnGhost" type="button">系統20分鐘</button>
              <button id="eyeSysRelax" class="btnGhost" type="button">系統20秒</button>
            </div>
          </div>
        </div>
      </section>

      <!-- POMO -->
      <section class="view" id="view-pomo">
        <div class="panel">
          <div class="panelHead">
            <div class="panelTitle">🍅 蕃茄模式</div>
            <div class="panelHint">預設 25/5（可在 JS 調整）。</div>
          </div>

          <div class="timerBox">
            <div class="timerBig" id="pomoTime">25:00</div>
            <div class="timerSub" id="pomoPhase">專注中</div>
            <div class="btnRow">
              <button id="pomoStart" class="btnPrimary" type="button">開始</button>
              <button id="pomoPause" class="btnGhost" type="button">暫停</button>
              <button id="pomoReset" class="btnGhost" type="button">重設</button>
              <button id="pomoSys" class="btnGhost" type="button">用系統計時器</button>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Dialog -->
    <dialog id="dlg" class="dlg">
      <div class="dlgTitle" id="dlgTitle">提示</div>
      <div class="dlgBody" id="dlgBody"></div>
      <div class="dlgActions">
        <button id="dlgOk" class="btnPrimary" type="button">確定</button>
      </div>
    </dialog>
  </div>

  <!-- =========================
  ✅ PWA 註冊（Service Worker）
  - 你需要在 repo 根目錄放一個 sw.js 才會真的離線
  - 若已存在 sw.js：這段會自動註冊
  - 若還沒有 sw.js：我下一步可以直接給你 sw.js 完整檔
  ========================= -->
  <script>
    (function () {
      // 讓後續任何檔案都可用同一個版本參數
      var tag = window.ASSET_TAG || "1911";

      // 嘗試把 CSS/JS 的 v 參數統一（避免你忘記改）
      try {
        var css = document.querySelector('link[href*="style.css"]');
        if (css && css.href.indexOf("v=") === -1) css.href = "./style.css?v=" + encodeURIComponent(tag);
      } catch (e) {}

      // Service Worker
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", function () {
          navigator.serviceWorker.register("./sw.js?v=" + encodeURIComponent(tag))
            .catch(function (err) {
              // 註冊失敗通常是：sw.js 不存在 / 路徑不對 / GitHub Pages scope 問題
              console.warn("SW register failed:", err);
            });
        });
      }
    })();
  </script>

  <!-- ✅ JS（外連 + 版本參數） -->
  <script src="./app.js?v=1912"></script>
</body>
</html>
